[gd_scene load_steps=23 format=2]

[ext_resource path="res://scenes/End.gd" type="Script" id=1]
[ext_resource path="res://scenes/Ball.tscn" type="PackedScene" id=2]
[ext_resource path="res://scenes/Bumper.tscn" type="PackedScene" id=3]
[ext_resource path="res://scenes/Peg.tscn" type="PackedScene" id=4]
[ext_resource path="res://scenes/Camera2D.gd" type="Script" id=5]
[ext_resource path="res://assets/ship2.png" type="Texture" id=7]
[ext_resource path="res://godot/theme.tres" type="Theme" id=8]
[ext_resource path="res://assets/gear.png" type="Texture" id=9]
[ext_resource path="res://assets/peggle.png" type="Texture" id=10]
[ext_resource path="res://assets/green-circle.png" type="Texture" id=11]
[ext_resource path="res://scenes/PowerBar.gd" type="Script" id=12]

[sub_resource type="StyleBoxFlat" id=24]
bg_color = Color( 0.133333, 0.12549, 0.203922, 1 )
corner_radius_top_left = 5
corner_radius_top_right = 5
corner_radius_bottom_right = 5
corner_radius_bottom_left = 5
anti_aliasing = false

[sub_resource type="Animation" id=25]
length = 0.001
tracks/0/type = "value"
tracks/0/path = NodePath("Panel:rect_scale")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/keys = {
"times": PoolRealArray( 0 ),
"transitions": PoolRealArray( 1 ),
"update": 0,
"values": [ Vector2( 1, 1 ) ]
}
tracks/1/type = "value"
tracks/1/path = NodePath("Panel:rect_rotation")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/keys = {
"times": PoolRealArray( 0 ),
"transitions": PoolRealArray( 1 ),
"update": 0,
"values": [ 0.0 ]
}

[sub_resource type="Animation" id=26]
resource_name = "wiggle"
tracks/0/type = "value"
tracks/0/path = NodePath(".:rect_rotation")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/keys = {
"times": PoolRealArray( 0, 0.1, 0.2, 0.3 ),
"transitions": PoolRealArray( 1, 1, 1, 1 ),
"update": 0,
"values": [ 5.0, 0.0, -5.0, 0.0 ]
}
tracks/1/type = "value"
tracks/1/path = NodePath(".:rect_scale")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/keys = {
"times": PoolRealArray( 0, 0.3 ),
"transitions": PoolRealArray( 1, 1 ),
"update": 0,
"values": [ Vector2( 1.05, 1.05 ), Vector2( 1, 1 ) ]
}

[sub_resource type="Shader" id=8]
code = "shader_type canvas_item;

uniform vec4 bg_color: hint_color;

float rand(vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233))) * 43758.5453123);
}

void fragment() {
	float size = 20.0;
	float prob = 0.995;
	vec2 pos = floor(1.0 / size * FRAGCOORD.xy);
	float color = 0.0;
	float starValue = rand(pos);

	if (starValue > prob)
	{
		vec2 center = size * pos + vec2(size, size) * 0.5;
		float t = 0.9 + 0.2 * sin(TIME * 8.0 + (starValue - prob) / (1.0 - prob) * 45.0);
		color = 1.0 - distance(FRAGCOORD.xy, center) / (0.5 * size);
		color = color * t / (abs(FRAGCOORD.y - center.y)) * t / (abs(FRAGCOORD.x - center.x));
	}
	else if (rand(SCREEN_UV.xy / 20.0) > 0.996)
	{
		float r = rand(SCREEN_UV.xy);
		color = r * (0.85 * sin(TIME * (r * 5.0) + 720.0 * r) + 0.95);
	}
	COLOR = vec4(vec3(color),1.0) + bg_color;
}"

[sub_resource type="ShaderMaterial" id=9]
shader = SubResource( 8 )
shader_param/bg_color = Color( 0.133333, 0.12549, 0.203922, 0 )

[sub_resource type="Shader" id=10]
code = "shader_type canvas_item;

uniform float battery : hint_range(0.0,1.0) = 1.0;
uniform float anchor : hint_range(-1.0,1.0) = -0.5;
uniform float speed_scale : hint_range(1.0, 10.0) = 1.0;
uniform float fov : hint_range(0.01, 1.0) = 0.2;
uniform vec4 background_color : hint_color = vec4(0.0, 0.1, 0.2, 1.0);
uniform vec4 grid_color : hint_color = vec4(1.0, 0.5, 1.0, 1.0);

float grid(vec2 uv, float batt) {
    vec2 size = vec2(uv.y, uv.y * uv.y * 0.2) * 0.01;
    uv += vec2(0.0, TIME * speed_scale * (batt + 0.05));
    uv = abs(fract(uv) - 0.5);
 	vec2 lines = smoothstep(size, vec2(0.0), uv);
 	lines += smoothstep(size * 5.0, vec2(0.0), uv) * 0.4 * batt;
    return clamp(lines.x + lines.y, 0.0, 3.0);
}

void fragment() {
	vec2 uv = UV;
	vec4 col = background_color;
    uv.y = 3.0 / (abs(uv.y + fov) + 0.05);
	uv.x += anchor;
    uv.x *= uv.y * 1.0;
    float gridVal = grid(uv, battery);
    col = mix(background_color, grid_color, gridVal);
	COLOR = col;
}"

[sub_resource type="ShaderMaterial" id=11]
shader = SubResource( 10 )
shader_param/battery = 0.0
shader_param/anchor = -0.5
shader_param/speed_scale = 1.0
shader_param/fov = 0.04
shader_param/background_color = Color( 0, 0.101961, 0.2, 0 )
shader_param/grid_color = Color( 0.156863, 0.145098, 0.258824, 1 )

[sub_resource type="RectangleShape2D" id=20]
extents = Vector2( 248, 6 )

[sub_resource type="Curve" id=21]
_data = [ Vector2( 0, 1 ), 0.0, 0.0, 0, 0, Vector2( 0.26087, 0.484091 ), 0.0, 0.0, 0, 0, Vector2( 0.5, 1 ), 0.0, 0.0, 0, 0, Vector2( 0.73913, 0.965909 ), 0.0, 0.0, 0, 0, Vector2( 1, 0 ), 0.0, 0.0, 0, 0 ]

[sub_resource type="CurveTexture" id=22]
curve = SubResource( 21 )

[sub_resource type="ParticlesMaterial" id=23]
flag_disable_z = true
spread = 180.0
gravity = Vector3( 0, 0, 0 )
initial_velocity = 129.94
orbit_velocity = 0.0
orbit_velocity_random = 0.0
linear_accel = -20.0
scale_curve = SubResource( 22 )

[node name="Game" type="Node2D"]

[node name="CanvasLayer" type="CanvasLayer" parent="."]

[node name="Settings" type="Button" parent="CanvasLayer"]
margin_left = 16.0
margin_top = 16.0
margin_right = 80.0
margin_bottom = 80.0
theme = ExtResource( 8 )
icon = ExtResource( 9 )
expand_icon = true

[node name="Board" type="Node2D" parent="."]
position = Vector2( 480, 272 )

[node name="BallsButton" type="Panel" parent="Board"]
margin_left = 264.0
margin_top = -232.0
margin_right = 400.0
margin_bottom = -165.0
theme = ExtResource( 8 )

[node name="Button" type="Button" parent="Board/BallsButton"]
margin_left = 8.0
margin_top = 8.0
margin_right = 128.0
margin_bottom = 59.0
theme = ExtResource( 8 )
text = "balls: 5"

[node name="PowerBar" type="Panel" parent="Board"]
margin_left = -320.0
margin_top = -232.0
margin_right = -264.0
margin_bottom = 220.0
rect_pivot_offset = Vector2( 28, 216 )
theme = ExtResource( 8 )
script = ExtResource( 12 )

[node name="Panel" type="Panel" parent="Board/PowerBar"]
margin_left = 8.0
margin_top = 8.0
margin_right = 48.0
margin_bottom = 444.0
custom_styles/panel = SubResource( 24 )

[node name="AnimationPlayer" type="AnimationPlayer" parent="Board/PowerBar"]
autoplay = "RESET"
anims/RESET = SubResource( 25 )
anims/wiggle = SubResource( 26 )

[node name="Level" type="Node2D" parent="Board"]

[node name="Outline" type="Panel" parent="Board/Level"]
margin_left = -248.0
margin_top = -232.0
margin_right = 248.0
margin_bottom = 220.0
theme = ExtResource( 8 )

[node name="Space" type="Panel" parent="Board/Level"]
material = SubResource( 9 )
margin_left = -240.0
margin_top = -220.0
margin_right = 240.0
margin_bottom = 212.0
theme = ExtResource( 8 )

[node name="Grid" type="Panel" parent="Board/Level"]
material = SubResource( 11 )
margin_left = -240.0
margin_top = -224.0
margin_right = 240.0
margin_bottom = 208.0
theme = ExtResource( 8 )

[node name="Bounds" type="StaticBody2D" parent="Board/Level"]

[node name="CollisionPolygon2D" type="CollisionPolygon2D" parent="Board/Level/Bounds"]
position = Vector2( -400, -252 )
polygon = PoolVector2Array( 152, 472, 152, 24, 648, 24, 648, 472, 640, 472, 640, 32, 160, 32, 160, 472 )

[node name="Bumper" parent="Board/Level" instance=ExtResource( 3 )]
position = Vector2( 0, 220 )

[node name="Bumper2" parent="Board/Level" instance=ExtResource( 3 )]
position = Vector2( -136, 220 )

[node name="Bumper3" parent="Board/Level" instance=ExtResource( 3 )]
position = Vector2( 136, 220 )

[node name="End" type="Area2D" parent="Board/Level"]
position = Vector2( 0, 216 )
script = ExtResource( 1 )

[node name="CollisionShape2D" type="CollisionShape2D" parent="Board/Level/End"]
position = Vector2( 0, -2 )
shape = SubResource( 20 )

[node name="Peggle" type="Sprite" parent="Board/Level"]
position = Vector2( -208, -248 )
scale = Vector2( 2, 2 )
texture = ExtResource( 10 )

[node name="Pegs" type="Node2D" parent="Board"]

[node name="Peg" parent="Board/Pegs" instance=ExtResource( 4 )]

[node name="Peg2" parent="Board/Pegs" instance=ExtResource( 4 )]
position = Vector2( -24, 24 )

[node name="Peg3" parent="Board/Pegs" instance=ExtResource( 4 )]
position = Vector2( 0, 24 )

[node name="Peg4" parent="Board/Pegs" instance=ExtResource( 4 )]
position = Vector2( 24, 24 )

[node name="Peg5" parent="Board/Pegs" instance=ExtResource( 4 )]
position = Vector2( 24, 0 )

[node name="Peg6" parent="Board/Pegs" instance=ExtResource( 4 )]
position = Vector2( -24, 0 )

[node name="Peg7" parent="Board/Pegs" instance=ExtResource( 4 )]
position = Vector2( -24, -24 )

[node name="Peg8" parent="Board/Pegs" instance=ExtResource( 4 )]
position = Vector2( 0, -24 )

[node name="Peg9" parent="Board/Pegs" instance=ExtResource( 4 )]
position = Vector2( 24, -24 )

[node name="Balls" type="Node2D" parent="Board"]

[node name="Ball" parent="Board/Balls" instance=ExtResource( 2 )]
position = Vector2( 0, -192 )

[node name="Camera2D" type="Camera2D" parent="Board"]
current = true
smoothing_enabled = true
script = ExtResource( 5 )
FOLLOW = NodePath("../Balls/Ball")

[node name="Particles2D" type="Particles2D" parent="Board"]
show_behind_parent = true
position = Vector2( -8, 0 )
amount = 60
lifetime = 3.0
preprocess = 4.0
randomness = 1.0
process_material = SubResource( 23 )
texture = ExtResource( 11 )

[node name="Ships" type="Node2D" parent="."]
position = Vector2( 480, -255 )

[node name="Sprite2" type="Sprite" parent="Ships"]
position = Vector2( 118.446, -19.8916 )
rotation = -1.00852
scale = Vector2( 0.636697, 0.563808 )
texture = ExtResource( 7 )

[connection signal="body_entered" from="Board/Level/End" to="Board/Level/End" method="_on_End_body_entered"]
